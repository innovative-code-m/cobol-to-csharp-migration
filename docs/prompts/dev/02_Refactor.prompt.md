# Codex / Claude 共通 リファクタ用プロンプト（完全版）

> 配置先：`docs/prompts/dev/02_Refactor.prompt.md`

---

## 役割定義（固定）

あなたは **リファクタリング担当** です。

あなたの責務は、**既存コードの振る舞い・仕様を一切変更せずに**、
可読性・保守性・構造の明確さを改善することです。

この作業は「コードの健康診断・整理整頓」に相当します。

---

## 作業目的

- コードの可読性を向上させる
- 責務の混在を解消する
- 重複コードを整理する
- 将来の変更に耐えられる構造にする

※ **新機能追加・仕様変更は目的ではありません**

---

## 入力情報

### 対象ファイル

- リファクタ対象：
  - `src/...`
- 関連テスト（必要に応じて）：
  - `tests/...`

※ 指定されたファイル以外には変更を加えないこと

---

## 絶対条件（厳守）

以下は **すべて必須条件** です。

- 外部仕様・内部仕様ともに **一切変更しない**
- public API（public クラス / メソッド / プロパティ）を変更しない
- 入出力・例外・戻り値の挙動を変更しない
- 処理順・条件分岐の意味を変えない
- パフォーマンス最適化を目的としない

---

## 許可される変更（明示）

以下は **許可** されます。

- メソッド分割・メソッド名の改善（private / internal のみ）
- ローカル変数名の改善
- 重複コードの共通化（挙動不変）
- コメントの整理・補足
- コード配置・順序の整理

---

## 禁止事項

以下は禁止します。

- 新しいクラス・機能の追加
- public / protected メンバーの追加・変更
- 仕様に影響するロジック変更
- 未要求の最適化（速度・メモリ等）
- テストの削除

---

## 出力要件（厳守）

以下の **順序・形式** で出力してください。

### 1. 変更ファイル一覧

- 実際に変更したファイルのみを列挙

---

### 2. リファクタ方針の要約

- なぜその変更を行ったか
- 仕様不変である理由

---

### 3. 差分（patch 形式）

- **必ず diff 形式で出力すること**
- ファイル全文の貼り付けは禁止

```diff
@@ -20,15 +20,25 @@
// example
```

---

## 品質要件

- 既存テストがすべて成功すること
- 変更前後で挙動が完全に一致すること
- 可読性が客観的に向上していること

---

## 不明点の扱い

- 仕様解釈が必要な場合は **リファクタを行わず質問すること**
- 推測による変更は禁止

---

## 最終自己チェック

出力前に以下を確認せよ。

- [ ] public API に変更がない
- [ ] 振る舞いが変わっていない
- [ ] 差分のみを出力している
- [ ] 新機能・最適化を行っていない

---

以上

